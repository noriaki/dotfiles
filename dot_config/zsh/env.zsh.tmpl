# ============================================================================
# env.zsh - Environment Variables and PATH Configuration
# ============================================================================
# Additional environment variables and PATH modifications
# ============================================================================

# ----------------------------------------------------------------------------
# Homebrew Configuration
# ----------------------------------------------------------------------------
# Homebrew prefix: {{ .homebrew_prefix }}
if [[ -d "{{ .homebrew_prefix }}" ]]; then
  eval "$({{ .homebrew_prefix }}/bin/brew shellenv)"
fi

# Hide Homebrew environment hints
export HOMEBREW_NO_ENV_HINTS=1

# Brewfile location (XDG compliant)
export HOMEBREW_BUNDLE_FILE="${XDG_CONFIG_HOME}/Brewfile"

# ----------------------------------------------------------------------------
# mise - Modern Version Manager (replaces anyenv/nodenv/pyenv/rbenv)
# ----------------------------------------------------------------------------
if command -v mise &> /dev/null; then
  eval "$(mise activate zsh)"
fi

# ----------------------------------------------------------------------------
# Language-Specific Environment Variables
# ----------------------------------------------------------------------------

# Node.js / pnpm
export PNPM_HOME="${XDG_DATA_HOME}/pnpm"
export PATH="${PNPM_HOME}:${PATH}"

# npm (XDG compliant)
export NPM_CONFIG_USERCONFIG="${XDG_CONFIG_HOME}/npm/npmrc"
export NODE_REPL_HISTORY="${XDG_STATE_HOME}/node_repl_history"
export PATH="${XDG_DATA_HOME}/npm/bin:${PATH}"

# Python
# Prevent Python from creating __pycache__ directories
export PYTHONDONTWRITEBYTECODE=1
# Use UTF-8 encoding for Python
export PYTHONIOENCODING='UTF-8'

# Ruby
# Disable Ruby documentation installation (faster gem installs)
export BUNDLE_SILENCE_ROOT_WARNING=1

# ----------------------------------------------------------------------------
# Editor Configuration
# ----------------------------------------------------------------------------
# Set default editor with fallback chain: code > nvim > vim > vi
if command -v code &> /dev/null; then
  export EDITOR='code --wait'
  export VISUAL='code --wait'
elif command -v nvim &> /dev/null; then
  export EDITOR='nvim'
  export VISUAL='nvim'
elif command -v vim &> /dev/null; then
  export EDITOR='vim'
  export VISUAL='vim'
else
  export EDITOR='vi'
  export VISUAL='vi'
fi

# ----------------------------------------------------------------------------
# General Environment Variables
# ----------------------------------------------------------------------------

# Language
export LANG='ja_JP.UTF-8'
export LC_ALL='ja_JP.UTF-8'

# Less pager configuration
export LESS='-R -F -X'
export LESSCHARSET='utf-8'
export LESSHISTFILE="${XDG_STATE_HOME}/less/history"

# Colorized man pages
export MANPAGER="less -R --use-color -Dd+r -Du+b"
export MANROFFOPT="-P -c"

# ----------------------------------------------------------------------------
# ls Color Configuration
# ----------------------------------------------------------------------------
{{- if .is_macos }}
# macOS (BSD ls) - Optimized for dark backgrounds / iTerm2
export LSCOLORS="ExGxCxDxBxegedabagacad"
export CLICOLOR=1
{{- end }}

# LS_COLORS for completions and GNU tools
export LS_COLORS="di=1;34:ln=1;36:so=32:pi=33:ex=1;32:bd=34;46:cd=34;43:su=30;41:sg=30;46:tw=30;42:ow=30;43"

# ----------------------------------------------------------------------------
# Custom PATH Additions
# ----------------------------------------------------------------------------
# Add local bin directories to PATH
export PATH="${HOME}/.local/bin:${PATH}"
export PATH="${HOME}/bin:${PATH}"
